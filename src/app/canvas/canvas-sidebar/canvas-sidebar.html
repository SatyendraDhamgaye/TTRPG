<div class="sidebar">
  <!-- Top navigation for switching sidebar modes. -->
  <div class="top-bar">
    <i (click)="setMode('map')" [class.active]="mode === 'map'" title="Map">üó∫</i>
    <i (click)="setMode('characters')" [class.active]="mode === 'characters'" title="Characters">üë§</i>
    <i (click)="setMode('tokens')" [class.active]="mode === 'tokens'" title="Tokens">üé¥</i>
    <i (click)="setMode('monsters')" [class.active]="mode === 'monsters'" title="Monsters">üßü</i>
    <i (click)="setMode('spells')" [class.active]="mode === 'spells'" title="Spells">‚ú®</i>
    <i (click)="setMode('music')" [class.active]="mode === 'music'" title="Music">üéß</i>
    <i (click)="setMode('settings')" [class.active]="mode === 'settings'" title="Settings">‚öôÔ∏è</i>
  </div>

  <!-- Token library and token creator mode. -->
  <div *ngIf="mode === 'tokens'" class="mode-container">
    <div class="search">
      <input placeholder="Search by name..." [(ngModel)]="search" />
    </div>

    <div class="scroll-zone">
      <div class="section-title">Tokens</div>

      <div class="token-list">
        <div class="token-row" *ngFor="let t of filteredTokens" draggable="true" (dragstart)="dragStart($event, t)">
          <img [src]="t.image" />
          <span>{{t.name}}</span>
          <button (click)="delete(t.id)">‚úï</button>
        </div>
      </div>
    </div>

    <div class="creator">
      New Token
      <input [(ngModel)]="name" placeholder="Name" />

      <input type="file" (change)="onFile($event)" />

      <div class="preview">
        <img *ngIf="image" [src]="image" />
        <span *ngIf="!image">No Image</span>
      </div>

      <select [(ngModel)]="size">
        <option value="medium">Medium 1x1</option>
        <option value="large">Large 2x2</option>
        <option value="huge">Huge 3x3</option>
        <option value="gargantuan">Gargantuan 4x4</option>
      </select>

      <button (click)="create()">Create</button>
    </div>
  </div>

  <!-- Monster compendium mode. -->
  <div *ngIf="mode === 'monsters'" class="mode-container">
    <div class="search">
      <input
        placeholder="Search monsters..."
        [ngModel]="monsterSearch"
        (ngModelChange)="onMonsterSearchChange($event)"
      />
    </div>

    <div *ngIf="loadingMonsters" class="loader">
      <div class="spinner"></div>
      <div class="loader-text">Loading monsters...</div>
    </div>

    <div *ngIf="!loadingMonsters" class="scroll-zone">
      <div class="section-title">Monsters</div>

      <div class="token-list">
        <div
          class="token-row"
          *ngFor="let m of filteredMonsters(); trackBy: trackMonsterById"
          draggable="true"
          (dragstart)="dragMonster($event, m)"
        >
          <div class="img-frame">
            <img
              [src]="m.image"
              loading="lazy"
              decoding="async"
              (error)="onMonsterImageError(m.id)"
            />
          </div>

          <span>{{m.name}}</span>
        </div>
      </div>
    </div>
  </div>

<div *ngIf="mode === 'spells'" class="mode-container">

  <div class="search">
    <input
      placeholder="Search spells..."
      [ngModel]="spellSearch"
      (ngModelChange)="onSpellSearchChange($event)"
    />
  </div>

  <!-- LOADING -->
  <div *ngIf="loadingSpells" class="loader">
    <div class="spinner"></div>
    <div class="loader-text">Loading spells...</div>
  </div>

  <!-- LIST -->
  <div *ngIf="!loadingSpells" class="scroll-zone">

    <div class="section-title">Spells</div>

    <div class="token-list">

      <div
        class="spell-row"
        *ngFor="let spell of filteredSpells(); trackBy: trackSpellByName"
        [ngClass]="[
          getSchoolClass(spell.school),
          expandedSpell === spell.name ? 'expanded' : ''
        ]"
        (click)="toggleSpell(spell.name)">

        <div class="spell-header">

          <div class="spell-info">
            <div class="spell-name">
              <span class="school-icon">
                {{ getSchoolIcon(spell.school) }}
              </span>
              {{ spell.name }}
            </div>

            <div class="spell-school">
              {{ getSchoolName(spell.school) }}
            </div>
          </div>

          <div class="spell-level">
            {{ spell.level === 0 ? 'Cantrip' : 'Lv ' + spell.level }}
          </div>

        </div>

        <!-- EXPANDABLE CONTENT -->
        <div
          class="spell-details"
          [class.open]="expandedSpell === spell.name">

          <div class="spell-meta-grid">

            <div><strong>Casting Time:</strong> {{ getCastingTime(spell) }}</div>

            <div><strong>Range:</strong> {{ getRange(spell) }}</div>

            <div>
              <strong>Duration:</strong>
              {{ getDuration(spell) }}
              <span *ngIf="isConcentration(spell)"> (Concentration)</span>
            </div>

            <div><strong>Components:</strong> {{ getComponents(spell) }}</div>

            <div *ngIf="isRitual(spell)">
              <strong>Ritual</strong>
            </div>

            <div><strong>Classes:</strong> {{ getClasses(spell) }}</div>

          </div>

          <div
            *ngFor="let entry of spell.entries"
            class="spell-paragraph"
            [innerHTML]="formatEntry(entry)">
          </div>

        </div>

      </div>

    </div>

  </div>

</div>





  <!-- Placeholder panels for unfinished modes. -->

  <div *ngIf="mode === 'map'" class="empty">
    Map tools coming soon...
  </div>

  <div *ngIf="mode === 'characters'" class="empty">
    Characters coming soon...
  </div>

  <div *ngIf="mode === 'music'" class="empty">
    Music player coming soon...
  </div>

  <div *ngIf="mode === 'settings'" class="empty">
    Settings panel coming soon...
  </div>
</div>